---
title: Issuing Credentials
sidebar:
  label: Issuing Credentials
  order: 2
---

An **issuer** decides which claims should always be visible and which can be selectively disclosed. This chapter walks through building an issuer service with salts, disclosures, and digests that comply with [draft-ietf-oauth-selective-disclosure-jwt-22](https://datatracker.ietf.org/doc/draft-ietf-oauth-selective-disclosure-jwt/).

## Anatomy of an SD-JWT payload

1. Plain JSON claims (`iss`, `iat`, `cnf`, etc.).
2. Optional `_sd_alg` top-level claim indicating the digest algorithm.
3. One `_sd` array for each object that contains selectively disclosable properties. `_sd` stores the digests of the associated disclosures.
4. For arrays, position-specific placeholders of the form `{ "...": "digest" }` are used.

The library enforces these rules when you wrap a value with `SdClaim::disclose()`.

## Configuring the issuer

```php
use Nyra\SdJwt\Issuer\SdJwtIssuer;
use Nyra\SdJwt\Issuer\IssuerOptions;
use Nyra\SdJwt\Claim\SdClaim;
use Nyra\SdJwt\Jwt\FirebaseJwtSigner;

$signer = new FirebaseJwtSigner('issuer-secret', 'HS256');
$issuer = new SdJwtIssuer($signer);

$claims = [
    'iss' => 'https://university.example',
    'sub' => 'student-123',
    'given_name' => 'Jordan',
    'family_name' => SdClaim::disclose('Nguyen'),
    'address' => [
        'locality' => SdClaim::disclose('Seattle'),
        'postal_code' => SdClaim::disclose('98101'),
    ],
    'nationalities' => ['US', SdClaim::disclose('CA')],
];

$options = new IssuerOptions(
    headers: ['typ' => 'vc+sd-jwt'],
    hashAlgorithm: 'sha-256',
);

$issued = $issuer->issue($claims, $options);
```

### What you get back

- `$issued->jwt()` – The issuer-signed JWT with `_sd_alg` and `_sd` digests.
- `$issued->disclosures()` – A list of `Disclosure` objects containing the encoded disclosure string, digest, and claim path.
- `$issued->toCompactPresentation()` – Convenience for sending all disclosures to a holder during issuance.

Each disclosure contains a salt generated by `RandomSaltGenerator`. You can provide your own salt generator if policy requires custom entropy sources.

## Including key binding material

Per Section 4.1.2 of the draft, add a confirmation (`cnf`) claim when you want verifiers to tie presentations to a holder key.

```php
$claims['cnf'] = [
    'jwk' => [
        'kty' => 'EC',
        'crv' => 'P-256',
        'x' => '...',
        'y' => '...',
    ],
];
```

The verifier chapter explains how the `sd_hash` claim is later checked against this key.

## Tips for production issuers

- Store digests alongside the credential to support revocation lists or diagnostic tooling.
- Use structured claims and nested disclosures to minimise repeated issuance.
- Shuffle disclosure digests to avoid leaking ordering information (the library sorts alphabetically by default).

Next, we focus on the holder: choosing which disclosures to send and optionally computing key-binding JWTs.

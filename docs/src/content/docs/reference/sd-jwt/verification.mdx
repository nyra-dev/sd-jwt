---
title: Verifier API
sidebar:
  label: Verifier API
  order: 4
---

## `SdJwtVerifier`

Central entry point for validating SD-JWT presentations.

```php
use Nyra\SdJwt\Verification\SdJwtVerifier;
use Nyra\SdJwt\Jwt\FirebaseJwtVerifier;
use Firebase\JWT\Key;

$jwtVerifier = new FirebaseJwtVerifier(new Key($issuerSecret, 'HS256'));
$verifier = new SdJwtVerifier($jwtVerifier);

$result = $verifier->verify($presentation, new VerifierOptions());
```

### Constructor

`__construct(JwtVerifierInterface $jwtVerifier, DigestCalculator $digestCalculator = new DigestCalculator())`

- You can plug in any JWT verifier that implements `JwtVerifierInterface`.
- The digest calculator determines supported hash algorithms (defaults to `sha-256`, `sha-384`, `sha-512`).

### `verify(string $presentation, ?VerifierOptions $options = null): VerifiedSdJwt`

Steps performed internally:

1. Parses presentation string into issuer JWT, disclosures, and optional kb+jwt.
2. Validates the issuer JWT signature and payload structure.
3. Reconstructs the claim set by matching each disclosure digest, including nested objects and arrays.
4. Applies key binding checks when configured.
5. Returns `VerifiedSdJwt` with the reconstructed payload and kb+jwt metadata.

## `VerifierOptions`

| Property | Type | Default | Description |
| -------- | ---- | ------- | ----------- |
| `requireKeyBinding` | `bool` | `false` | Whether kb+jwt must be present. |
| `keyBindingKey` | `Key|null` | `null` | Optional override for the holder public key. If null, the verifier reads `cnf.jwk` from the SD-JWT. |
| `expectedAudience` | `string|null` | `null` | Expected kb+jwt audience. |
| `expectedNonce` | `string|null` | `null` | Expected nonce. |
| `maxIssuedAtFutureSkew` | `int` | `60` | Allowed seconds into the future for `iat`. |
| `maxIssuedAtPastSkew` | `int` | `300` | Allowed seconds into the past for `iat`. |
| `currentTime` | `int|null` | `time()` | Time reference used in `iat` validation. |

## `VerifiedSdJwt`

- `issuerSignedJwt(): string`
- `header(): array<string,mixed>` – Decoded JOSE header from the issuer JWT.
- `payload(): array<string,mixed>` – Fully reconstructed claim set.
- `disclosures(): array<string>` – Encoded disclosures that were processed.
- `hashAlgorithm(): string`
- `keyBindingJwt(): ?string`
- `keyBindingHeaders(): ?array<string,mixed>`
- `keyBindingPayload(): ?array<string,mixed>`

## Helpers

- `Presentation::fromString()` – Parser used internally; throws `InvalidPresentation` on malformed strings.
- `DisclosureParser` – Validates disclosure structure before hashing.
- `VerifierState` – Manages placeholder replacement, duplicate detection, and cleanup of `_sd` scaffolding.
- `JwkConverter` – Converts octet, RSA, and EC JWKs into PEM strings for kb-jwt signature verification.

## Exceptions

All exceptions live under `Nyra\SdJwt\Exception`. Relevant ones for verifiers include:

| Exception | Meaning |
| --------- | ------- |
| `SignatureVerificationFailed` | The issuer JWT signature could not be verified. |
| `InvalidDisclosure` | Malformed disclosure structure. |
| `UnmatchedDisclosure` | A disclosure digest did not map to any `_sd` entry. |
| `DuplicateDisclosure` | The same disclosure was presented twice. |
| `InvalidKeyBinding` | kb+jwt claims failed validation. |
| `KeyBindingVerificationFailed` | kb+jwt signature failed. |
| `MissingKeyBinding` | `requireKeyBinding` was `true` but no kb+jwt was present. |
| `DigestCollision` | Duplicate digest encountered during verification. |

Handle these exceptions to provide actionable messages to relying parties.
